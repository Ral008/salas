#{extends 'main.html' /}
#{set title:'Exportar Nota de Entrega sin Valores' /}
#{set 'moreScripts'}
<script src="@{'/public/javascripts/bootstrap-datepicker.js'}" type="text/javascript" charset="${_response_encoding}"></script>
#{/set}
#{set 'moreStyles'}
<link rel="stylesheet" media="screen" href="@{'/public/stylesheets/datepicker.css'}">
#{/set}
<div class="well">
	<fieldset>
		<legend>Nota de Entrega sin Valores</legend>
		<form class="form-horizontal">
		    <div class="control-group">
				<label class="control-label">Nro. Nota Entrega</label>
				<div style="margin-left:10px;">
				<div class="controls">
					<div class="input-append">
						<input type="text" id="nroNotaEntrega" name="nroNotaEntrega" autocomplete="off"/>
					</div>
				</div>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Fecha Nota Entrega</label>
				<div style="margin-left:10px;">
				<div class="controls">
					<div class="input-append">
						<input type="text" id="fechaNotaEntrega" name="fechaNotaEntrega" autocomplete="off"/>
					</div>
				</div>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="coCliente">Cliente</label>
				<div style="margin-left:-20px;">
				<div class="controls">
				   <select name="coCliente" id="coCliente" class="span5" autocomplete="off">
					  <option value="00">Seleccione</option>
					  #{list listCliente,as:'cliente'}
					  <option value="${cliente.coCliente}">${cliente.deNombre}</option>
					  #{/list}
				  </select>								
				</div>
				</div>
			</div>
			<div class="form-actions">
				<button class="btn btn-primary" type="button" id="btnBuscarNotaEntrega">Buscar</button>
				<button class="btn" type="button" id="btnCancelar">Cancelar</button>
			</div>
		</form>
	</fieldset>
</div>
<table class="table table-striped table-bordered table-condensed">
	<thead>
		<tr>
			<th style="color:#0088CC;">ID</th>	
			<th style="color:#0088CC;">NRO. NOTA ENTREGA</th>
			<th style="color:#0088CC;">CLIENTE</th>
			<th style="color:#0088CC;">FECHA</th>
			<th style="color:#0088CC;">MONTO</th>
			<th style="color:#0088CC;">ESTADO</th>
			<th style="color:#0088CC;">VER</th>
		</tr>
	</thead>
	<tbody id="tabla-de-nota-entrega">
		
	</tbody>
</table>
<script type="text/javascript">
var ExpNESinTotales = {
	VERDETALLE : "@{ExportarNESinMonto.verDetalle()}",
	init : function(){
		$('#coCliente').select2();
		$("#fechaNotaEntrega").datepicker({format: 'dd/mm/yyyy',autoclose: true,language: 'es'});
		$(document).delegate("#btnBuscarNotaEntrega","click",ExpNESinTotales.buscarNotaEntrega);	
		$(document).delegate("#btnCancelar","click",ExpNESinTotales.cancelar);
		ExpNESinTotales.buscarNotaEntrega();
	},
	buscarNotaEntrega : function(){
		$.ajax({
			url:"@{ExportarNESinMonto.buscarNotaEntregaSinMonto()}",
			data:{
				nroNotaEntrega   : $("#nroNotaEntrega").val(),
				fechaNotaEntrega : $("#fechaNotaEntrega").val(),
				coCliente        : $("#coCliente").val()
			},
			success:function(result){
				$("#tabla-de-nota-entrega").html(ExpNESinTotales.printNotaEntregas(result));
			}
		})
	},
	printNotaEntregas : function(obj){
		var html="";
		for(var i = 0 ; i < obj.length ; i++){
			html+="<tr>";
				html+="<td>"+obj[i].id_notaE+"</td>";
				html+="<td>"+obj[i].nro_notaE+"</td>";
				html+="<td>"+obj[i].cliente+"</td>";
				html+="<td>"+obj[i].fecha_notaE+"</td>";
				html+="<td>"+obj[i].montoNE+"</td>";
				html+="<td>"+obj[i].estadoNE+"</td>";
				html+="<td><a href="+ExpNESinTotales.VERDETALLE+"/"+obj[i].id_notaE+" class='btn btn-mini'><i class='icon-eye-open'></i></a></td>";
			html+="</tr>";
		}
		return html;
	},
	cancelar : function(){
		location.reload();
	}
}
$(function(){
	ExpNESinTotales.init();
})
</script>