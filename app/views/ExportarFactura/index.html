#{extends 'main.html' /}
#{set title:'Exportar Factura' /}
#{set 'moreScripts'}
<script src="@{'/public/javascripts/bootstrap-datepicker.js'}" type="text/javascript" charset="${_response_encoding}"></script>
#{/set}
#{set 'moreStyles'}
<link rel="stylesheet" media="screen" href="@{'/public/stylesheets/datepicker.css'}">
#{/set}
<div class="well">
	<fieldset>
		<legend>Facturas</legend>
		<form class="form-horizontal">
		    <div class="control-group">
				<label class="control-label">Nro. Factura</label>
				<div style="margin-left:10px;">
				<div class="controls">
					<div class="input-append">
						<input type="text" id="nroFactura" name="nroFactura" autocomplete="off"/>
					</div>
				</div>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Fecha Factura</label>
				<div style="margin-left:10px;">
				<div class="controls">
					<div class="input-append">
						<input type="text" id="fechaFactura" name="fechaFactura" autocomplete="off"/>
					</div>
				</div>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="coCliente">Cliente</label>
				<div style="margin-left:-20px;">
				<div class="controls">
				   <select name="coCliente" id="coCliente" class="span5" autocomplete="off">
					  <option value="00">Seleccione</option>
					  #{list listCliente,as:'cliente'}
					  <option value="${cliente.coCliente}">${cliente.deNombre}</option>
					  #{/list}
				  </select>								
				</div>
				</div>
			</div>
			<div class="form-actions">
				<button class="btn btn-primary" type="button" id="btnBuscarFactura">Buscar</button>
				<button class="btn" type="button" id="btnCancelar">Cancelar</button>
<!-- 				<button class="btn" type="submit" id="btnExportarProductos">Exportar</button> -->
			</div>
		</form>
	</fieldset>
</div>
<table class="table table-striped table-bordered table-condensed">
	<thead>
		<tr>
			<th style="color:#0088CC;">ID</th>	
			<th style="color:#0088CC;">NRO. FACTURA</th>
			<th style="color:#0088CC;">CLIENTE</th>
			<th style="color:#0088CC;">FECHA</th>
			<th style="color:#0088CC;">MONTO</th>
			<th style="color:#0088CC;">ESTADO</th>
			<th style="color:#0088CC;">VER</th>
		</tr>
	</thead>
	<tbody id="tabla-de-facturas">
		
	</tbody>
</table>
<script type="text/javascript">
var ExpFacturas = {
	VERDETALLE : "@{ExportarFactura.verDetalle()}",
	init : function(){
		$('#coCliente').select2();
		$("#fechaFactura").datepicker({format: 'dd/mm/yyyy',autoclose: true,language: 'es'});
		$(document).delegate("#btnBuscarFactura","click",ExpFacturas.buscarFacturas);	
		$(document).delegate("#btnCancelar","click",ExpFacturas.cancelar);
		ExpFacturas.buscarFacturas();
	},
	buscarFacturas : function(){
		$.ajax({
			url:"@{ExportarFactura.buscarFacturas()}",
			data:{
				nroFactura   : $("#nroFactura").val(),
				fechaFactura : $("#fechaFactura").val(),
				coCliente    : $("#coCliente").val()
			},
			success:function(result){
				$("#tabla-de-facturas").html(ExpFacturas.printFacturas(result));
			}
		})
	},
	printFacturas : function(obj){
		var html="";
		for(var i = 0 ; i < obj.length ; i++){
			html+="<tr>";
				html+="<td>"+obj[i].id_factura+"</td>";
				html+="<td>"+obj[i].nro_factura+"</td>";
				html+="<td>"+obj[i].cliente+"</td>";
				html+="<td>"+obj[i].fecha_factura+"</td>";
				html+="<td>"+obj[i].monto+"</td>";
				html+="<td>"+obj[i].estado+"</td>";
				html+="<td><a href="+ExpFacturas.VERDETALLE+"/"+obj[i].id_factura+" class='btn btn-mini'><i class='icon-eye-open'></i></a></td>";
			html+="</tr>";
		}
		return html;
	},
	cancelar : function(){
		location.reload();
	}
}
$(function(){
	ExpFacturas.init();
})
</script>