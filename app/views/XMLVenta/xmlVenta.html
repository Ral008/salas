#{extends 'main.html' /}
#{set title:'XML VENTAS' /}
<div class="well">
	<fieldset>
		<legend>XML VENTAS</legend>
		<form class="form-horizontal" action="@{XMLVenta.exportarVentasByMesAnio()}">	
		    <div class="control-group">
				<label class="control-label" for="deMes">Mes</label>
				<div class="controls">
					<select id="deMes" name="deMes" type="select-one" autocomplete="off">
						<option value="00">Seleccione</option>
						<option value="01">ENERO</option>
						<option value="02">FEBRERO</option>
						<option value="03">MARZO</option>
						<option value="04">ABRIL</option>
						<option value="05">MAYO</option>
						<option value="06">JUNIO</option>
						<option value="07">JULIO</option>
						<option value="08">AGOSTO</option>
						<option value="09">SEPTIEMBRE</option>
						<option value="10">OCTUBRE</option>
						<option value="11">NOVIEMBRE</option>
						<option value="12">DICIEMBRE</option>
					</select>						
				</div>
			</div>	
			<div class="control-group">
				<label class="control-label" for="deAnio">AÃ±o</label>
				<div class="controls">
					<select id="deAnio" name="deAnio" type="select-one" autocomplete="off">
						<option value="00">Seleccione</option>
						<option value="${year}">${year}</option>
						<option value="${pastYear}">${pastYear}</option>												
					</select>						
				</div>
			</div>																			
			<div class="form-actions">
				<button class="btn btn-primary" type="button" id="btnBuscarVentas">Buscar Ventas</button>
				<button class="btn" type="submit" id="btnGeneralXML">Generar XML</button>
			</div>
		</form>		
	</fieldset>
</div>
#{if band}
	<div id="alert" class="alert alert-success">XML File de ventas fue generado satisfactoriamente</div>
#{/if}
<table class="table table-striped table-bordered table-condensed" id="report-ventas">
	<thead>
		<tr>
		    <th style="color:#0088CC">tpIdCliente</th>
		    <th style="color:#0088CC">idCliente</th>
		    <th style="color:#0088CC">tipoComprobante</th>
		    <th style="color:#0088CC">numeroComprobantes</th>
		    <th style="color:#0088CC">baseNoGraIva</th>
		    <th style="color:#0088CC">baseImponible</th>
		    <th style="color:#0088CC">baseImpGrav</th>
		    <th style="color:#0088CC">montoIva</th>
		    <th style="color:#0088CC">valorRetIva</th>
		    <th style="color:#0088CC">valorRetRenta</th>				
		</tr>
	</thead>
	<tbody id="tabla-de-ventas">		
	</tbody>
</table>
<script type="text/javascript">
var XMLVentas = function(){
		var detalle="@{XMLVenta.index()}";	
		function init(){			
			$(document).delegate("#btnBuscarVentas","click",buscarVentas);			
		};	
										
		function buscarVentas(){
				if($("#deMes").val()=="00"){
					alert("Tiene que seleccionar el MES");
				}else{
					if($("#deAnio").val()=="00"){
						alert("Tiene que seleccionar el AÑO");
					}else{						
						$.ajax({
							url:"@{XMLVenta.listaDeVentasByMesAnio()}",
							data:{deMes   : $("#deMes").val(),
								  deAnio  : $("#deAnio").val()							  				
							     },
							success:function(result){
								$("#tabla-de-ventas").html(printVentas(result));
								$('#alert').hide();
							}
						})
						
					}					
				}						
		}
						
		function printVentas(obj){
			var html ="";
			for(var i = 0 ; i < obj.length ; i++){
				html+="<tr>";
				html+="<td>"+obj[i].tpIdCliente+"</td>";
				html+="<td>"+obj[i].idCliente+"</td>";
				html+="<td>"+obj[i].tipoComprobante+"</td>";
				html+="<td>"+obj[i].numeroComprobantes+"</td>";
				html+="<td>"+obj[i].baseNoGraIva+"</td>";
				html+="<td>"+obj[i].baseImponible+"</td>";
				html+="<td>"+obj[i].baseImpGrav+"</td>";
				html+="<td>"+obj[i].montoIva+"</td>";
				html+="<td>"+obj[i].valorRetIva+"</td>";
				html+="<td>"+obj[i].valorRetRenta+"</td>";
				html+="</tr>";
			}
			return html;
		}
		
	return {init : init}
}();
XMLVentas.init();
</script>