#{extends 'main.html' /}
#{set title:'General Report' /}
<div class="well">
	<fieldset>
		<legend>General Report</legend>
		<form style="float:left;" class="form-horizontal" action="@{Report.exportMembers()}">
		    <input type="hidden" id="orden" name="orden">
			<div class="control-group">
				<label class="control-label">Providers</label>
				<div class="controls">
					<select class="span3" name="coTypeProvider" id="coTypeProvider">
						<option value="00">Select All</option>
						#{list items:listTypeProvider,as:'typeProvider'}
						<option value="${typeProvider.coTypeProvider}">${typeProvider.deName}</option>
						#{/list}
					</select>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Service type</label>
				<div class="controls">
					<select class="span3" name="coProvider" id="coProvider">
						<option value="00">Select All</option>
					</select>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Physician</label>
				<div class="controls">
					<select class="span3" name="coPhysician" id="coPhysician">
						<option value="00">Select All</option>
						#{list items:listPhysician,as:'physician'}
						<option value="${physician.coPhysician}">${physician.deName}</option>
						#{/list}
					</select>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Enroll by</label>
				<div class="controls">
					<select class="span3" name="coEnroll" id="coEnroll">
						<option value="00">Select All</option>
						#{list items:listEnroll,as:'enroll'}
						<option value="${enroll.coPersona}">${enroll.deNombre}</option>
						#{/list}
					</select>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label required-form" for="deMemberId">Member ID</label>
				<div class="controls">
					<div class="input-append">
						<input type="text" name="deMemberId" id="deMemberId" class="span3" autocomplete="off"/>
					</div>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label required-form" for="deFirstName">First Name</label>
				<div class="controls">
					<div class="input-append">
						<input type="text" name="deFirstName" id="deFirstName" class="span3" autocomplete="off"/>
					</div>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label required-form" for="deLastName">Last Name</label>
				<div class="controls">
					<div class="input-append">
						<input type="text" name="deLastName" id="deLastName" class="span3" autocomplete="off"/>
					</div>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label required-form" for="dePhone">Phone</label>
				<div class="controls">
					<div class="input-append">
						<input type="text" name="dePhone" id="dePhone" class="span3" autocomplete="off"/>
					</div>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Status</label>
				<div class="controls">
					<select class="span3" name="stMember" id="stMember">
						<option value="00">Select All</option>
						<option value="1">Active</option>
						<option value="0">Inactive</option>
						<option value="2">Pending</option>
					</select>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Approved?</label>
				<div class="controls">
					<select class="span3" name="stOk" id="stOk">
						<option value="00">Select All</option>
						<option value="1">Yes</option>
						<option value="0">Not</option>
					</select>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Incentive</label>
				<div class="controls">
					<select class="span3" name="coIncentive" id="coIncentive">
						<option value="00">Select All</option>
						#{list items:listIncentive,as:'incentive'}
						<option value="${incentive.coIncentive}">${incentive.labelIncentive}</option>
						#{/list}
					</select>
				</div>
			</div>	
			<div class="control-group">
				<label class="control-label">Enroll Month</label>
				<div class="controls">
					<select class="span1m" name="month" id="month">
					<option value="00">Month</option>
						#{list items:1..12, as:'m'}
						#{if m <= 9}
                        <option value="0${m}">0${m}</option>
                        #{/if}
                        #{else}
                        <option value="${m}">${m}</option>
                        #{/else}
                        #{/list}
					</select>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Enroll Year</label>
				<div class="controls">
					<select class="span1m" name="year" id="year">
					<option value="00">Year</option>
					#{list items:2012..2013, as:'y'}
                    <option value="${y}">${y}</option>
                    #{/list}
					</select>
				</div>
			</div>				
			<div class="form-actions">
				<button class="btn btn-primary" type="button" id="btnBuscarMember">Search</button>				
				<button class="btn btn-info" type="button" id="btnExportMemberOnlyUpload">Export only to upload</button>
				<button class="btn" type="submit" id="btnExportarProductos">Export report</button>
			</div>
		</form>
		<div style="float:right;width:500px">	
		<h3>Summarized:</h3>
		<table  class="table table-striped table-bordered table-condensed" id="sumarizado">		
	     <thead>
		   <tr>
			<th>Provider</th>
			<th>Service Type</th>
			<th>Total Members</th>
		   </tr>
	     </thead>
	     <tbody id="tabla-de-sumarizado">		
	     </tbody>
        </table>
        <div style="float:left;" class="control-group">
			<label class="control-label" Style="font-weight: bold;">Total Active</label>							
			<span class="input-small uneditable-input" id="total_active"></span>																					    				
		</div>	
		<div style="float:left;" class="control-group">
			<label class="control-label" Style="font-weight: bold;">Total Inactive</label>							
			<span class="input-small uneditable-input" id="total_inactive"></span>																					    				
		</div>
		<div style="float:left;" class="control-group">
			<label class="control-label" Style="font-weight: bold;">Total Pending</label>							
			<span class="input-small uneditable-input" id="total_pending"></span>																					    				
		</div>				
        </div>
	</fieldset>
</div>
<table class="table table-striped table-bordered table-condensed">
	<thead>
		<tr>
		    <th><a href="#" class="memberid">Member ID</a></th>
			<th><a href="#" class="first">First Name</a></th>
			<th><a href="#" class="middle">Middle Name</a></th>
			<th><a href="#" class="last">Last Name</a></th>			
			<th style="color:#0088CC;">Enroll Date<a href="#" class="enroll-date-up" id="up"><i class='icon-arrow-up'></i></a><a href="#" class="enroll-date-down" id="down"><i class='icon-arrow-down'></i></a></th>
			<th style="color:#0088CC;">Effective Date<a href="#" class="effective-date-up" id="up2"><i class='icon-arrow-up'></i></a><a href="#" class="effective-date-down" id="down2"><i class='icon-arrow-down'></i></a></th>
			<th><a href="#" class="service-type">Service Type</a></th>
			<th><a href="#" class="provider">Provider</a></th>
			<th><a href="#" class="physician">Physician</a></th>
			<th><a href="#" class="enroll-by">Enroll by</a></th>
		</tr>
	</thead>
	<tbody id="tabla-de-members">		
	</tbody>
</table>
<script type="text/javascript">
var Report = function(){
		//var detalle="@{Report.index()}";	
		function init(){
			$("#up").hide();
			$("#up2").hide();
			sumarizado();
			$(document).delegate("#btnBuscarMember","click",buscarMembers);		
			$(document).delegate("#btnExportMemberOnlyUpload","click",exportMemberOnlyUpload);	
			$(document).delegate("#coTypeProvider","change",listarProviderByType);
			$(document).delegate('.first','click',first);
			$(document).delegate('.middle','click',middle);
			$(document).delegate('.last','click',last);
			$(document).delegate('.memberid','click',memberID);
			$(document).delegate('.enroll-date-up','click',enrollDateUp);
			$(document).delegate('.enroll-date-down','click',enrollDateDown);
			$(document).delegate('.effective-date-up','click',effectiveDateUp);
			$(document).delegate('.effective-date-down','click',effectiveDateDown);
			$(document).delegate('.service-type','click',serviceType);
			$(document).delegate('.provider','click',provider);
			$(document).delegate('.physician','click',physician);
			$(document).delegate('.enroll-by','click',enrollBy);
		};	
		
		function exportMemberOnlyUpload(){
			location.href="@{Report.exportMemberOnlyUpload()}";
		}
		
		function first(){
			$("#orden").val("first");	
			buscarMembers();
			$("#orden").val("");
		}
		
		function middle(){
			$("#orden").val("middle");	
			buscarMembers();
			$("#orden").val("");
		}
		
		function last(){
			$("#orden").val("last");	
			buscarMembers();
			$("#orden").val("");
		}
		
		function memberID(){
			$("#orden").val("memberid");	
			buscarMembers();
			$("#orden").val("");
		}
		
		function enrollDateUp(){
			$("#orden").val("enrollDateUp");	
			buscarMembers();
			$("#orden").val("");
			$("#up").hide();
			$("#down").show();
		}
		
		function enrollDateDown(){
			$("#orden").val("enrollDateDown");	
			buscarMembers();
			$("#orden").val("");
			$("#up").show();
			$("#down").hide();
		}
		
		function effectiveDateUp(){
			$("#orden").val("effectiveDateUp");	
			buscarMembers();
			$("#orden").val("");
			$("#up2").hide();
			$("#down2").show();
		}
		
		function effectiveDateDown(){
			$("#orden").val("effectiveDateDown");	
			buscarMembers();
			$("#orden").val("");
			$("#up2").show();
			$("#down2").hide();
		}
		
		function serviceType(){
			$("#orden").val("serviceType");	
			buscarMembers();
			$("#orden").val("");		
		}
		
		function provider(){
			$("#orden").val("provider");	
			buscarMembers();
			$("#orden").val("");		
		}
		
		function physician(){
			$("#orden").val("physician");	
			buscarMembers();
			$("#orden").val("");		
		}
		
		function enrollBy(){
			$("#orden").val("enrollBy");	
			buscarMembers();
			$("#orden").val("");		
		}
		
		function buscarMembers(){
			$.ajax({
				url:"@{Report.listReportGeneralMembers()}",
				data:{coTypeProvider  : $("#coTypeProvider").val(),
					  coProvider  : $("#coProvider").val(),
					  coPhysician : $("#coPhysician").val(),
					  coEnroll    : $("#coEnroll").val(),
					  deMemberId  : $("#deMemberId").val(),
					  deFirstName : $("#deFirstName").val(),
					  deLastName  : $("#deLastName").val(),
					  dePhone     : $("#dePhone").val(),
					  stMember    : $("#stMember").val(),
					  stOk        : $("#stOk").val(),
					  coIncentive : $("#coIncentive").val(),
					  month       : $("#month").val(),
					  year        : $("#year").val(),
					  orden       : $("#orden").val()
				     },
				success:function(result){
					$("#tabla-de-members").html(printMembers(result));
				}
			})
			sumarizado();
		}
		
		function sumarizado(){
			$.ajax({
			url:"@{Report.listSumarizadoGeneral()}",
			data:{coTypeProvider  : $("#coTypeProvider").val(),
				  coProvider 	  : $("#coProvider").val(),
				  month           : $("#month").val(),
				  year            : $("#year").val()
			     },
			success:function(result){
				$("#tabla-de-sumarizado").html(printSumarizado(result));
				$("#total_active").text(result[0].total_active);
				$("#total_inactive").text(result[0].total_inactive);
				$("#total_pending").text(result[0].total_pending);
			}
		    })
	    }
		
	    function listarProviderByType(){
			if(this.value !="00"){
				$.ajax({
					url:"@{Member.traerProvider()}",
					async: false,
					data:{
						coTypeProvider : $("#coTypeProvider").val()
					},
					success:function(RESULT){				
						var html ='<option value="00">Select All</option>'
						$.each(RESULT,function(key,value){													
							html+='<option value="'+value.coProvider+'">';
							html+=value.deName;
							html+='</option>';
						});
						$("#coProvider").html(html);
					}
				});	
			}else{
				$("#coProvider").html('<option value="00">Select All</option>');
			}			
		}
		
		function printMembers(obj){
			var html ="";
			for(var i = 0 ; i < obj.length ; i++){
				html+="<tr>";
				html+="<td>"+obj[i].member_id+"</td>";
				html+="<td>"+obj[i].first_name+"</td>";
				html+="<td>"+obj[i].midle_name+"</td>";	
				html+="<td>"+obj[i].last_name+"</td>";	
				html+="<td>"+obj[i].enroll_date+"</td>";
				html+="<td>"+obj[i].effective_date+"</td>";
				html+="<td>"+obj[i].service_type+"</td>";
				html+="<td>"+obj[i].provider_name+"</td>";
				html+="<td>"+obj[i].physician+"</td>";
				html+="<td>"+obj[i].enroll_By+"</td>";
				html+="</tr>";
			}
			return html;
		}
		
		function printSumarizado(obj){
			var html ="";
			var total = 0;
			for(var i = 1 ; i < obj.length ; i++){
				html+="<tr>";
				html+="<td>"+obj[i].provider+"</td>";
				html+="<td>"+obj[i].service_type+"</td>";
				html+="<td>"+obj[i].total_member+"</td>";						
				html+="</tr>";
				total = total + obj[i].total_member; 
			}			
			html+="<tr>";
			html+="<td></td>";
			html+="<td style='font-weight: bold; color:#0A2CD7;'>TOTAL MEMBERS</td>";	
			html+="<td style='font-weight: bold; color:#0A2CD7;'>"+total+"</td>";
			html+="</tr>";
			return html;
		}
		
	return {init : init}
}();
Report.init();
</script>